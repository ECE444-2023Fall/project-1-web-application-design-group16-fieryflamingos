{% import "bootstrap/wtf.html" as wtf %}
{% extends 'base.html' %}
{% block content %}
<!DOCTYPE html>
<html>

<head>
	<title>Discover</title>
	<link rel="stylesheet" type="text/css"
		href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
	<link rel="stylesheet" href="/static/css/forms.css" />
</head>

<body>
	{% for message in get_flashed_messages() %}
	<div class="flash alert alert-success col-sm-4" role="success">
		{{ message }}
	</div>
	{% endfor %}

	<div style="margin-left: 10%; margin-right: 10%;">
		<div class="main-title" style="margin-bottom: 40px; font-size: 30px;">
			Filter Parameters
		</div>

		{% if error %}
		<p class="alert alert-danger col-sm-4" role="danger">
			<strong>Error:</strong> {{ error }}
		</p>
		{% endif %}
		<form method="POST" action="" >
			{{form.hidden_tag()}}
			<div class="label-bold" style="margin-bottom: 10px;">
				Keyword Search
			</div>
			{{ form.search(class="search-form", style="width: 100%") }}
		
			<div style="display: flex; margin-top: 10px; margin-bottom: 10px;">
				<div class="label-bold" style="width: 50%;">
					Start Date
				</div>
				<div class="label-bold" style="width: 50%;">
					End Date
				</div>
			</div>
		
			<div style="display: flex; margin-top: 10px; margin-bottom: 10px;">
				<div style="width: 50%;">
					{{ form.start_date(class="search-form", style="width: 90%") }}
				</div>
				<div style="width: 50%;">
					{{ form.end_date(class="search-form", style="width: 100%") }}
				</div>
			</div>
		
			<div class="label-bold" style="margin-top: 10px; margin-bottom: 10px;">
				Interests
			</div>
			<div style="display: flex; flex-wrap: wrap; flex-direction: row; justify-content: flex-start;">
				{{ form.preferences() }}
			</div>
		
			<div style="margin-bottom: 10px; margin-top: 10px; display: flex; justify-content:space-between;">
				<div style="margin-right: 40px;">
					{{ form.submit(class="button-main") }}
				</div>
				<p>{{count}} results found.</p>
			</div>
			
		</form>
		
		
	</div>


	<div id="filtered-events" style="background-color: #F1F5F9; padding-bottom: 60px;">
		<div style="margin-left: 10%; margin-right: 10%;">
			<div style="display: flex; justify-content:space-between; align-items:center; margin-bottom: 40px; padding-top: 40px; ">
				<div class="main-title" style="font-size: 30px;">
					Filtered Events
				</div>
				<div style="display:flex; justify-content:space-between; align-items:center;">
					<div style="display:flex; align-items:center;">Page {{page + 1}} of {{max_pages}}</div>
				</div>
				<div style="display:flex; justify-content:center; align-items:center; gap:1rem">
					{% if show_prev_button %}
					<div tabindex="0" class="button-main" style="height:100%" onclick="switchPage(-1)">Back</div>
					{% endif %}
					{% if show_next_button %}
					<div tabindex="0" class="button-main" style="height:100%" onclick="switchPage(1)">Next</div>
					{% endif %}
				</div>
				

			</div>
			{% for event in events %}
				<a href="{{event.link}}" style="text-decoration: none">
					<div class="white-card-container" style="flex: 60%; margin-bottom: 30px;">
						<div class="title" style="margin-bottom: 16px;" >
							{{event.title}}
						</div>
						<hr style="margin-bottom: 20px; width: auto;">
						<div style="display: flex; margin-bottom: 8px;">
							<div style="display: flex; width: 50%;">
								<span class="label-bold" style="margin-right: 6px;">
									Organizer: 
								</span>
								<div class="label">
									{{event.organizer.name}}
								</div>
							</div>
							<div style="display: flex; width: 50%;">
								<span class="label-bold" style="margin-right: 6px;">
									Time: 
								</span>
								<div class="label">
									{{ event.event_date.from_date.strftime('%b %d, %Y %I:%M') }} - {{ event.event_date.to_date.strftime('%I:%M %p').lstrip('0')|upper }}
								</div>
							</div>
						</div>
						<div style="display: flex; margin-bottom: 16px;">
							<div style="display: flex; width: 50%;">
								<span class="label-bold" style="margin-right: 6px;">
									Location: 
								</span>
								<div class="label">
									{{event.location.address}}, {{event.location.room}}
								</div>
							</div>
						</div>			
					</div>
				</a>			
			{% endfor %}
			<div style="margin-bottom: 40px; margin-top: 40px; display: flex; justify-content:space-between;">
				<div class="main-title" style="visibility: hidden;font-size: 30px;">
					Filtered Events
				</div>
				<div style="display:flex; justify-content:space-between; align-items:center;">
					<div style="display:flex; align-items:center;">Page {{page + 1}} of {{max_pages}}</div>
				</div>
				<div style="display:flex; justify-content:center; align-items:center; gap:1rem">
					{% if show_prev_button %}
					<div tabindex="0" class="button-main" style="height:100%" onclick="switchPage(-1)">Back</div>
					{% endif %}
					{% if show_next_button %}
					<div tabindex="0" class="button-main" style="height:100%" onclick="switchPage(1)">Next</div>
					{% endif %}
				</div>
			</div>
			
		</div>
	</div>

	
	<script>
		function switchPage(nextOrPrev) {
			const urlParams = new URLSearchParams(window.location.search);
			let page = "{{page}}";
			let pageAsNumber = Number(page);
			urlParams.set('page', `${pageAsNumber+nextOrPrev}`);
			let url = `${window.location.pathname}?${urlParams}#filtered-events`;
			window.location = url;
		}
	</script>
</body>

</html>
{% endblock %}